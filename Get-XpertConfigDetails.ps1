$servers= (
'I07OPDBSVCAPP1.partners.extranet.microsoft.com',
'I07OPDBSVCAPP2.partners.extranet.microsoft.com',
'I01OPDBSVCAPP1.partners.extranet.microsoft.com',
'I01OPDBSVCAPP2.partners.extranet.microsoft.com',
'I07OPDCSQLCIS1.northamerica.corp.microsoft.com',
'I01OPDCSQLCIS1.northamerica.corp.microsoft.com',
'I07OPDBSQLCOR1.partners.extranet.microsoft.com',
'I07OPDBSQLCOR2.partners.extranet.microsoft.com',
'I01OPDBSQLCOR1.partners.extranet.microsoft.com',
'I01OPDBSQLCOR2.partners.extranet.microsoft.com',
'I07OPDCSQLDM1.northamerica.corp.microsoft.com',
'I07OPDCSQLDM2.northamerica.corp.microsoft.com',
'I01OPDCSQLDM1.northamerica.corp.microsoft.com',
'I07OPDFWEBDOC1.partners.extranet.microsoft.com',
'I07OPDFWEBDOC2.partners.extranet.microsoft.com',
'I01OPDFWEBDOC1.partners.extranet.microsoft.com',
'I01OPDFWEBDOC2.partners.extranet.microsoft.com',
'I07OPCSQLDSS1.northamerica.corp.microsoft.com',
'I07OPCSQLDSS2.northamerica.corp.microsoft.com',
'I01OPDCSQLDSS1.northamerica.corp.microsoft.com',
'I07OPDBFILFSA1.partners.extranet.microsoft.com',
'I07OPDBFILFSA2.partners.extranet.microsoft.com',
'I01OPDBFILFSA1.partners.extranet.microsoft.com',
'I01OPDBFILFSA2.partners.extranet.microsoft.com',
'I07OPDFWEBMOO1.partners.extranet.microsoft.com',
'I07OPDFWEBMOO2.partners.extranet.microsoft.com',
'I01OPDFWEBMOO1.partners.extranet.microsoft.com',
'I01OPDFWEBMOO2.partners.extranet.microsoft.com',
'I07OPDCSVCMQ1.northamerica.corp.microsoft.com',
'I07OPDCSVCMQ2.northamerica.corp.microsoft.com',
'I01OPDCSVCMQ1.northamerica.corp.microsoft.com',
'I01OPDCSVCMQ2.northamerica.corp.microsoft.com',
'I07OPDBSQLPRS1.partners.extranet.microsoft.com',
'I07OPDBSQLPRS2.partners.extranet.microsoft.com',
'I01OPDBSQLPRS1.partners.extranet.microsoft.com',
'I01OPDBSQLPRS2.partners.extranet.microsoft.com',
'I07OPDCSQLRPD1.northamerica.corp.microsoft.com',
'I07OPDCSQLRPD2.northamerica.corp.microsoft.com',
'I01OPDCSQLRPD1.northamerica.corp.microsoft.com',
'I07OPDBSQLRPL1.partners.extranet.microsoft.com',
'I07OPDBSQLRPL2.partners.extranet.microsoft.com',
'I01OPDBSQLRPL1.partners.extranet.microsoft.com',
'I07OPDBSQLRPT1.partners.extranet.microsoft.com',
'I07OPDBSQLRPT2.partners.extranet.microsoft.com',
'I01OPDBSQLRPT1.partners.extranet.microsoft.com',
'I01OPDBSQLRPT2.partners.extranet.microsoft.com',
'I07OPDCSQLSRS1.northamerica.corp.microsoft.com',
'I07OPDCSQLSRS2.northamerica.corp.microsoft.com',
'I07OPDBWEBSRS1.partners.extranet.microsoft.com',
'I07OPDBWEBSRS2.partners.extranet.microsoft.com',
'I01OPDCSQLSRS1.northamerica.corp.microsoft.com',
'I01OPDCSQLSRS2.northamerica.corp.microsoft.com',
'I01OPDBWEBSRS1.partners.extranet.microsoft.com',
'I01OPDBWEBSRS2.partners.extranet.microsoft.com',
'I07OPDBSQLUI1.partners.extranet.microsoft.com',
'I07OPDBSQLUI2.partners.extranet.microsoft.com',
'I01OPDBSQLUI1.partners.extranet.microsoft.com',
'I01OPDBSQLUI2.partners.extranet.microsoft.com',
'I07OPDBSQLWHS1.partners.extranet.microsoft.com',
'I07OPDBSQLWHS2.partners.extranet.microsoft.com',
'I01OPDBSQLWHS1.partners.extranet.microsoft.com',
'I01OPDBSQLWHS2.partners.extranet.microsoft.com',
'I07OPDFOAWEB1.partners.extranet.microsoft.com',
'I07OPDFOAWEB2.partners.extranet.microsoft.com',
'I07OPDFOAWEB3.partners.extranet.microsoft.com',
'I07OPDFOASVC1.partners.extranet.microsoft.com',
'I07OPDFOASVC2.partners.extranet.microsoft.com',
'I07OPDFOASVC3.partners.extranet.microsoft.com',
'I07OPDBOAAPP1.partners.extranet.microsoft.com',
'I07OPDBOAAPP2.partners.extranet.microsoft.com',
'I07OPDBOAAPP3.partners.extranet.microsoft.com',
'I07OPDBOAAPP4.partners.extranet.microsoft.com',
'I07OPDBOAAPP5.partners.extranet.microsoft.com',
'CO1OEMPSQLOA3.partners.extranet.microsoft.com',
'CO1OEMPSQLOA4.partners.extranet.microsoft.com',
'I07OPDBOAIS1.partners.extranet.microsoft.com',
'I07OPDBOACCH1.partners.extranet.microsoft.com',
'I07OPDCSQLRDS1.northamerica.corp.microsoft.com',
'I07OPDCBAMRS1.northamerica.corp.microsoft.com',
'I07OPDBRAAPP1.partners.extranet.microsoft.com',
'I07OPDBRAAPP2.partners.extranet.microsoft.com',
'I04OPDFOASVC1.partners.extranet.microsoft.com',
'I04OPDFOASVC2.partners.extranet.microsoft.com',
'I04OPDFOASVC3.partners.extranet.microsoft.com',
'I04OPDBOAAPP1.partners.extranet.microsoft.com',
'I04OPDBOAAPP2.partners.extranet.microsoft.com',
'I04OPDBOAAPP3.partners.extranet.microsoft.com',
'I04OPDBOAAPP4.partners.extranet.microsoft.com',
'I04OPDBOAAPP5.partners.extranet.microsoft.com',
'DB3OEMPSQLOA3.partners.extranet.microsoft.com',
'DB3OEMPSQLOA4.partners.extranet.microsoft.com',
'I04OPDBOAIS1.partners.extranet.microsoft.com',
'I04OPDBOACCH1.partners.extranet.microsoft.com',
'I01OPDFOAWEB1.partners.extranet.microsoft.com',
'I01OPDFOAWEB2.partners.extranet.microsoft.com',
'I01OPDFOAWEB3.partners.extranet.microsoft.com',
'I01OPDBOAAPP1.partners.extranet.microsoft.com',
'I01OPDBOAAPP2.partners.extranet.microsoft.com',
'I01OPDBOAAPP3.partners.extranet.microsoft.com',
'I01OPDBOAAPP4.partners.extranet.microsoft.com',
'I01OPDBOAAPP5.partners.extranet.microsoft.com',
'CY1OEMPDSQLOA1.partners.extranet.microsoft.com',
'CY1OEMPDSQLOA2.partners.extranet.microsoft.com',
'I01OPDBOAIS1.partners.extranet.microsoft.com',
'I01OPDBOACCH1.partners.extranet.microsoft.com',
'I01OPDCSQLRDS01.northamerica.corp.microsoft.com',
'I01OPDBRAAPP1.partners.extranet.microsoft.com',
'I01OPDBRAAPP2.partners.extranet.microsoft.com'
)
$ReadXpertAgentCongif = {
    [xml]$xml=$null
     
    if(Test-Path "D:\XpertAgent\data\AgentIdentityConfiguration.xml")
    {
        $xml = Get-Content D:\XpertAgent\data\AgentIdentityConfiguration.xml
    }
    elseif (Test-Path "E:\XpertAgent\data\AgentIdentityConfiguration.xml")
    {
        $xml = Get-Content E:\XpertAgent\data\AgentIdentityConfiguration.xml
    }
    
    [string]$Environment = $xml.AgentIdentityConfiguration.Environment | Out-String     
    [string]$Role = $xml.AgentIdentityConfiguration.Role | Out-String 
    
    $Detail = New-Object -TypeName PSObject -Property @{
        ServerName = $env:COMPUTERNAME.Trim()
        XpertEnvironment = $Environment.Trim()
        XpertRole = $Role.Trim()
    }   

    $Detail
}

$Details=@()
$Pass = "**********" | ConvertTo-SecureString -AsPlainText -Force; $Account='redmond\lpoaasvc'
$credential = [System.Management.Automation.PSCredential]::new($Account, $Pass)

Foreach($server in $servers)
{
    $session = New-PSSession -ComputerName $server -Credential $credential
    $Details +=Invoke-Command -Session $session -ScriptBlock $ReadXpertAgentCongif 
}

$Details | Select PSComputerName, XpertEnvironment, XpertRole | Format-Table -AutoSize